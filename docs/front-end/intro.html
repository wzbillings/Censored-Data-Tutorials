<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.510">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Bayesian censoring - 1&nbsp; What are censored data?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../examples/simple-censored-outcome/index.html" rel="next">
<link href="../index.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../front-end/intro.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">What are censored data?</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Bayesian censoring</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../front-end/intro.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">What are censored data?</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">First models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../examples/simple-censored-outcome/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">One censored outcome</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Case studies</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../front-end/references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">What are censored data?</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Censoring is a selection phenomenon on data which occurs when we can only obtain precise measurements for certain measurement values. The classical example is a scale which can only measure weights up to a certain threshold, say <span class="math inline">\(y_{\mathrm{max}}\)</span>. A scale that can measure any weight would produce the set of measurements <span class="math inline">\(\{y_1^*, y_2^*, \ldots, y_n^*\}\)</span> where <span class="math inline">\(n\)</span> is the sample size. We call these the <strong>latent values</strong> or <strong>true values</strong>. Our imperfect scale would then produce the <strong>observed values</strong>, <span class="math display">\[
y_i = \begin{cases}
y_i^*, &amp; y_i^* \leq y_{\mathrm{max}} \\
y_{\mathrm{max}}, &amp; y_i^* &gt; y_{\mathrm{max}}
\end{cases}; \quad i = 1, \ldots, n.
\]</span> Specifically, this is an example of <strong>right censoring</strong>, where there is an <strong>upper limit of detection</strong>, or maximum value that we can observe with precision. Right censoring is also incredibly common in epidemiology and biomedical studies: when we conduct an observational study or clinical trial, we expect to observe individuals who have not experienced the outcome of interest before the trial ends. These individuals have a time-to-event with a lower bound of the length of the trial (the event could have occurred the moment we stopped observing) and an infinite upper bound, because the event may never occur. Such an individual’s survival time would be right-censored, and many common survival analysis methods can account for right-censored data (assuming an appropriate parametric distribution for the outcome).</p>
<p>We can also have the opposite case, where we can detect any theoretical measurement above a certain value. In this case, the data are said to have a <strong>lower limit of detection</strong> and this phenomenon is called <strong>left censoring</strong>. For example, imagine we are testing the concentration of lead in the tap water of several buildings. Our test cannot detect lead levels below 1 part per billion (ppb), but can detect any larger amount of lead. In that case, our observed values would instead look like this: <span class="math display">\[
\begin{aligned}
y_i &amp;= \begin{cases}
y_i^*, &amp; y_i^* \geq y_{\mathrm{min}} \\
y_{\mathrm{min}}, &amp; y_i^* &lt; y_{\mathrm{min}}
\end{cases};\\
i &amp;= 1, \ldots, n; \\
y_{\min} &amp;= 1 \text{ ppb;}
\end{aligned}
\]</span> where <span class="math inline">\(y_{\mathrm{min}}\)</span> is the lower limit of detection. I don’t know anything about how lead concentration tests work, but suppose that at a certain point our test “saturates”: we know that the concentration is at or above, say, 5 parts per million (ppm), but the test cannot detect any higher values. Then some of our observations would be left-censored (below the lower LOD) and some observations would be right-censored (above the upper LOD). So then the lead level data that we observe would look this:</p>
<p><span class="math display">\[
\begin{aligned}
y_i &amp;= \begin{cases}
y_{\mathrm{min}}, &amp; y_i^* &lt; y_{\mathrm{min}} \\
y_i^*, &amp; y_{\max} \geq y_i^* \geq y_{\mathrm{min}} \\
y_{\max}, &amp; y_i^* &gt; y_{\max}
\end{cases};\\
i &amp;= 1, \ldots, n; \\
y_{\min} &amp;= 1 \text{ ppb;} \\
y_{\max} &amp;= 5 \text{ ppm;}
\end{aligned}
\]</span> Note that for a continuous random variable like (presumably) the level of lead in drinking water, it doesn’t really matter which categories include the boundary values, because <span class="math inline">\(P(Y_i^* = y_i^*) = 0\)</span> for any value of <span class="math inline">\(y_i^*\)</span> including <span class="math inline">\(y_{\min}\)</span> and <span class="math inline">\(y_{\max}\)</span>. If the censored variable is not absolutely continuous, then this distinction may need to be clarified and depends on the observation process.</p>
<p>Finally, we can have interval censoring, where we know a data value is within some interval, but we do not know precisely where the value lies within that interval. We could imagine a lead test that looks like this (whether such a test could exist in reality, I am unsure). Suppose that the test involves dipping a test strip into water, and the test strip changes color based on the amount of lead present in the water. However, only a discrete number of shades can be visibility distinguished, so even though the underlying variable of interest is continuous (again, the lead concentration), we only observe a discrete set of outcomes. For example, if our outcome can only reliably discern 6 different concentrations, the data might look like this. The table below also includes a coding scheme in the “Data Value” column showing how we might write down the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>colfunc <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"white"</span>, <span class="st">"firebrick3"</span>))</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>conc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"&lt;1 ppb"</span>, <span class="st">"1 ppb - 10 ppb"</span>, <span class="st">"10 ppb - 100 ppb"</span>, <span class="st">"100 ppb - 1000 ppb"</span>,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"1000 ppb - 5000 ppb"</span>, <span class="st">"&gt;5000 ppb"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">50</span>, <span class="dv">500</span>, <span class="dv">2500</span>, <span class="dv">5000</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>table_data <span class="ot">&lt;-</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Lead Concentration"</span> <span class="ot">=</span> conc,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Strip Color"</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(conc),</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Data Value"</span> <span class="ot">=</span> values</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>lead_table <span class="ot">&lt;-</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    table_data <span class="sc">|&gt;</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    gt<span class="sc">::</span><span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    gt<span class="sc">::</span><span class="fu">data_color</span>(</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">Strip Color</span><span class="st">`</span>),</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">palette =</span> <span class="fu">colfunc</span>(<span class="fu">length</span>(conc))</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    gt<span class="sc">::</span><span class="fu">tab_style</span>(</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">style =</span> gt<span class="sc">::</span><span class="fu">cell_text</span>(<span class="at">color =</span> <span class="st">"#00000000"</span>),</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">locations =</span> gt<span class="sc">::</span><span class="fu">cells_body</span>(<span class="at">columns =</span> <span class="st">`</span><span class="at">Strip Color</span><span class="st">`</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>lead_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="ymfyoyadfe" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#ymfyoyadfe table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ymfyoyadfe thead, #ymfyoyadfe tbody, #ymfyoyadfe tfoot, #ymfyoyadfe tr, #ymfyoyadfe td, #ymfyoyadfe th {
  border-style: none;
}

#ymfyoyadfe p {
  margin: 0;
  padding: 0;
}

#ymfyoyadfe .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ymfyoyadfe .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ymfyoyadfe .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ymfyoyadfe .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ymfyoyadfe .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ymfyoyadfe .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ymfyoyadfe .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ymfyoyadfe .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ymfyoyadfe .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ymfyoyadfe .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ymfyoyadfe .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ymfyoyadfe .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ymfyoyadfe .gt_spanner_row {
  border-bottom-style: hidden;
}

#ymfyoyadfe .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ymfyoyadfe .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ymfyoyadfe .gt_from_md > :first-child {
  margin-top: 0;
}

#ymfyoyadfe .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ymfyoyadfe .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ymfyoyadfe .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ymfyoyadfe .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ymfyoyadfe .gt_row_group_first td {
  border-top-width: 2px;
}

#ymfyoyadfe .gt_row_group_first th {
  border-top-width: 2px;
}

#ymfyoyadfe .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ymfyoyadfe .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ymfyoyadfe .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ymfyoyadfe .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ymfyoyadfe .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ymfyoyadfe .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ymfyoyadfe .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ymfyoyadfe .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ymfyoyadfe .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ymfyoyadfe .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ymfyoyadfe .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ymfyoyadfe .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ymfyoyadfe .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ymfyoyadfe .gt_left {
  text-align: left;
}

#ymfyoyadfe .gt_center {
  text-align: center;
}

#ymfyoyadfe .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ymfyoyadfe .gt_font_normal {
  font-weight: normal;
}

#ymfyoyadfe .gt_font_bold {
  font-weight: bold;
}

#ymfyoyadfe .gt_font_italic {
  font-style: italic;
}

#ymfyoyadfe .gt_super {
  font-size: 65%;
}

#ymfyoyadfe .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ymfyoyadfe .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ymfyoyadfe .gt_indent_1 {
  text-indent: 5px;
}

#ymfyoyadfe .gt_indent_2 {
  text-indent: 10px;
}

#ymfyoyadfe .gt_indent_3 {
  text-indent: 15px;
}

#ymfyoyadfe .gt_indent_4 {
  text-indent: 20px;
}

#ymfyoyadfe .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="Lead Concentration" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Lead Concentration</th>
<th id="Strip Color" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Strip Color</th>
<th id="Data Value" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Data Value</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="Lead Concentration">&lt;1 ppb</td>
<td class="gt_row gt_right" headers="Strip Color" style="background-color: #FFFFFF; color: rgba(0,0,0,0)">1</td>
<td class="gt_row gt_right" headers="Data Value">0</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Lead Concentration">1 ppb - 10 ppb</td>
<td class="gt_row gt_right" headers="Strip Color" style="background-color: #F5D3D3; color: rgba(0,0,0,0)">2</td>
<td class="gt_row gt_right" headers="Data Value">5</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Lead Concentration">10 ppb - 100 ppb</td>
<td class="gt_row gt_right" headers="Strip Color" style="background-color: #EBA8A8; color: rgba(0,0,0,0)">3</td>
<td class="gt_row gt_right" headers="Data Value">50</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Lead Concentration">100 ppb - 1000 ppb</td>
<td class="gt_row gt_right" headers="Strip Color" style="background-color: #E17C7C; color: rgba(0,0,0,0)">4</td>
<td class="gt_row gt_right" headers="Data Value">500</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Lead Concentration">1000 ppb - 5000 ppb</td>
<td class="gt_row gt_right" headers="Strip Color" style="background-color: #D75151; color: rgba(0,0,0,0)">5</td>
<td class="gt_row gt_right" headers="Data Value">2500</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Lead Concentration">&gt;5000 ppb</td>
<td class="gt_row gt_right" headers="Strip Color" style="background-color: #CD2626; color: rgba(0,0,0,0)">6</td>
<td class="gt_row gt_right" headers="Data Value">5000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>In general there is not a unique or standardized way to write down interval censored data, and writing down the data model will heavily depend on the observation process and the coding scheme for the values. For this specific example, we could write down the observation model like this:</p>
<p><span class="math display">\[
y_i = \begin{cases}
0, &amp; 1 &gt; y_i^* \\
5, &amp; 10 &gt; y_i^* \geq 1 \\
50, &amp; 100 &gt; y_i^* \geq 10 \\
500, &amp; 1000 &gt; y_i^* \geq 100 \\
2500, &amp; 5000 &gt; y_i^* \geq 1000 \\
5000, &amp; y_i^* \geq 5000
\end{cases}; \quad i = 1, \ldots, n.
\]</span> It is possible to write the math model in a more compact form as well — we will discuss this further in a detailed section on interval censoring.</p>
<p>Another example of this is influenza HAI titer, which we will dedicate an entire case study to later on. Briefly, the values are typically reported as 10, 20, 40, etc., but a value of 10 does not mean the precise value of the measurement should be 10, it means the true value is between 10 and 20. If we assume our titer is measured on the log scale and has no limits of detection, we could write <span class="math display">\[
y_i = \lfloor y_i^* \rfloor; \quad i = 1, \ldots, n,
\]</span> because we only perform a discrete number of dilutions. This gives us the interval value for <span class="math inline">\(y_i\)</span> as <span class="math display">\[y_i \in \left[\lfloor y_i^* \rfloor, \lfloor y_i^* + 1 \rfloor\right).\]</span></p>
<p>A given variable can be subject to all of these types of censoring simultaneously: for example, HAI titers are interval censored in this way, but they also have lower limits of detection and upper limits of detection as well (though the upper limits are rarely important in practice because they can be arbitrarily increased during the assay). However, a particular observation of this variable can only be subject to one type of censoring at a time: e.g., if an observation is below the detection limit, that value is left censored, it cannot simultaneously be right censored or interval censored.</p>
<p>Notably, the distinction between “types” of censoring in this way is useful for several analytic methods, but is not strictly necessary. All censored values can be implicitly treated as interval censored data, where the lower endpoint for a left censored value is negative infinity, and the upper endpoint for a right censored value is positive infinity. Thus, we could write the data generating process for HAI titers with LOD as <span class="math display">\[
y_i = \begin{cases}
y_{l}, &amp; \ y_i^* &lt; y_{\text{min}}\\
\lfloor y_i^* \rfloor, &amp;\ y_{\text{min}} \leq y_i^* &lt; y_{\text{max}} \\
y_{i}, &amp; y_i^* \leq y_{\text{max}}
\end{cases},
\]</span> where <span class="math inline">\(y_{\text{min}}\)</span> is the lower limit of detection and <span class="math inline">\(y_{\text{max}}\)</span> is the upper limit of detection. Here, <span class="math inline">\(y_l \leq y_{\min}\)</span> and <span class="math inline">\(y_u \geq y_{\max}\)</span> are arbitrary constants that can be the same as the limits of detection or not, so long as we know which censoring category the given <span class="math inline">\(y_i\)</span> value falls into. We can write down the value for the censored values however we want as long as we know what interval the points fall into.</p>
<p>To express the DGP in interval notation, we would write <span class="math display">\[
y_i \in \begin{cases}
\left(-\infty, y_{l}\right), &amp; y_i^* &lt; y_{\text{min}}\\
\left[\lfloor y_i^* \rfloor, \lfloor y_i^* + 1 \rfloor\right), &amp; y_{\text{min}} \leq y_i^* &lt; y_{\text{max}} \\
\left[y_{u}, \infty\right), &amp; y_i^* \leq y_{\text{max}}
\end{cases}.
\]</span> Note also that assuming <span class="math inline">\(y^*_i\)</span> is drawn from an absolutely continuous distribution (e.g.&nbsp;normal or lognormal, etc.), the final likelihood model will be equivalent regardless of which intervals are open or closed. This model would allow us to put all of the censored observations into the likelihood function in the same framework without having to worry about sorting the observations into buckets w.r.t. the type of censoring.</p>
<p>The probability of each observation <span class="math inline">\(y_i\)</span> can then be expressed as the probability that the random variable <span class="math inline">\(Y\)</span> takes on a realization inside the given interval. That is, if <span class="math inline">\(y_i^*\)</span> is detectable (greater than the lower LoD, but less than the upper LoD), we would write <span class="math display">\[P(Y_i = y_i) = P\left(\lfloor y_i^* + 1 \rfloor \geq Y_i^* \geq \lfloor y_i^* \rfloor \right).\]</span> Recall that every random variable <span class="math inline">\(Y\)</span> has a <a href="https://en.wikipedia.org/wiki/Cumulative_distribution_function">cumulative density function</a>, or <strong>CDF</strong>, which is defined as <span class="math display">\[F_Y(y) = P(Y \leq y).\]</span> Using the definitions of all these probability things, we can say (proof omitted) that <span class="math display">\[
\begin{aligned}
P(Y_i = y_i) &amp;= P\left(\lfloor y_i^* + 1 \rfloor \geq Y_i^* \geq \lfloor y_i^* \rfloor \right) \\
&amp;= P(Y_i^* \leq \lfloor y_i^* + 1 \rfloor) - P(Y_i \leq \lfloor y_i^* \rfloor) \\
&amp;= F_Y(\lfloor y_i^* + 1 \rfloor) - F_Y(\lfloor y_i^* \rfloor).
\end{aligned}
\]</span> This applies to the nondetectable measurements as well, but we need to take the limit as <span class="math inline">\(Y_i \to \pm \infty\)</span>.Fortunately, this is a defining property of the CDF as you can see on the linked wikipedia page. So we can write <span class="math display">\[
\begin{aligned}
P(Y_i = y_\min) &amp;= \lim_{a \to -\infty}P\left(y_{\text{min}} \geq Y_i^* \geq a \right) \\
&amp;= F(y_\min) - \lim_{a \to -\infty} F(a) \\
&amp;= F(y_\min) - 0 = F(y_\min).
\end{aligned}
\]</span> Similarly, we get that <span class="math display">\[
\begin{aligned}
P(Y_i = y_\max) &amp;= \lim_{b \to \infty}P\left(b \geq Y_i^* \geq y_\max \right) \\
&amp;= \lim_{b \to \infty} F(b) -  F(y_\max) \\
&amp;= 1 - F(y_\max).
\end{aligned}
\]</span></p>
<p>At first, it can be difficult to see how this probability calculations are useful for statistical data analysis. To fully make the connection, we will need to make use of an indicator variable, say <span class="math inline">\(c_i\)</span>, which is equal to 1 when the observation <span class="math inline">\(y_i\)</span> is censored, and equal to 0 if <span class="math inline">\(y_i\)</span> is not censored. To fit some parametric model with parameter vector <span class="math inline">\(\theta\)</span>, we often turn to the likelihood function, which is <span class="math display">\[
\mathcal{L}\left(\theta \mid y \right) = f_Y(y \mid \theta)
\]</span> if there are no censored values (here we implicitly assume that <span class="math inline">\(y\)</span> is absolutely continuous). The function <span class="math inline">\(f_Y(y \mid \theta)\)</span> is the <a href="https://en.wikipedia.org/wiki/Probability_density_function">probability density function</a> of random variable <span class="math inline">\(Y\)</span> where we consider the parameters to be fixed at the value <span class="math inline">\(\theta\)</span>.</p>
<p>In constructing the likelihood for our observation <span class="math inline">\(Y_i\)</span>, we run into the slightly tricky business<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> that <span class="math inline">\(Y_i\)</span> is not always continuous – if the <span class="math inline">\(i\)</span>th observation is censored, <span class="math inline">\(Y_i\)</span> actually becomes discrete. We will not address the technicalities of combining censored and discrete data here, but suffice to say if the parametric model we assume for <span class="math inline">\(Y_i\)</span> is any standard (all GLM compatible distributions and many others beyond), we can say that <span class="math display">\[
\mathcal{L}(\theta \mid y_i) = \bigg( f(y_i \mid \theta) \bigg)^{1 - c_i} \bigg( P(Y_i = y_i)\bigg)^{c_i}.
\]</span> That is, we can use the continuous probability density <span class="math inline">\(f\)</span> when <span class="math inline">\(y_i\)</span> is not censored and the discrete probability of the realization <span class="math inline">\(y_i\)</span> if the observation is censored.</p>
<p>We can then (assuming mutual, potentially conditional, independence of the observations) write the likelihood of the sample by multiplying together all of our individual <span class="math inline">\(y_i\)</span> likelihoods. With the sample likelihood in hand, we can proceed to do whatever kinds of torture we would normally do in modern statistics, like finding parameter values that maximize the likelihood, or adding priors and using Bayes’ theorem.</p>
<p><strong>In the following chapters, we’ll discuss a bit more theory but primarily go through some examples.</strong> Notably, we’ve only discussed univariate analyses here, so in the first example we’ll walk through an actual example of dealing with a censored outcome variable. Dealing with censored predictor/independent variables is much more detailed, and will be explained in its own example.</p>
<!--
Now, given that $F$ is the CDF for the parametric distribution which we
assume the latent variable $y_i^*$ is drawn from, with parameter vector $\theta$,
the contribution of $y_i$ to the likelihood is then
$$\mathcal{L}(\theta \mid Y_i) = F(\text{upper limit of interval}) - F(\text{lower limit of interval}).$$
If we call the lower limit of the interval for $y_i$ $L_i$ and the corresponding
upper limit $U_i$, we can write the likelihood of the sample as
$$
\mathcal{L}(\theta \mid \mathbf{Y}) = \prod_{i=1}^n \left(
F(y_i \mid \theta)\bigg\rvert_{y_i = L_i}^{U_i}
\right)^{C_i}\bigg(f(y_i\mid \theta) \bigg)^{C_i},
$$
where $C_i$ is the indicator variable for $y_i$ being censored. Notably, for an uncensored observation the likelihood is equal to the density. However, for the typical
types of HAI data that we see, all of the assay values are subject to the
same censoring process, and thus we could neglect the density component.

So now the remaining issue is to specify $F$, the CDF of the latent variables.
-->
<!-- END OF FILE -->


<aside id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>to really get into the details of this, you need <a href="https://en.wikipedia.org/wiki/Lebesgue's_decompositon_theorem">Lebesgue’s decomposition theorem</a> which relies on measure theory. Writing out the likelihood in a more general form without the censoring indicators is also not possible without measure theory because it relies on the <a href="https://en.wikipedia.org/wiki/Radon%E2%80%93Nikodym_theorem">Radon-Nikodym theorem</a>. If this is the part you want to learn about, you will have to learn it from someone other than me!<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</aside>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    const typesetMath = (el) => {
      if (window.MathJax) {
        // MathJax Typeset
        window.MathJax.typeset([el]);
      } else if (window.katex) {
        // KaTeX Render
        var mathElements = el.getElementsByClassName("math");
        var macros = [];
        for (var i = 0; i < mathElements.length; i++) {
          var texText = mathElements[i].firstChild;
          if (mathElements[i].tagName == "SPAN") {
            window.katex.render(texText.data, mathElements[i], {
              displayMode: mathElements[i].classList.contains('display'),
              throwOnError: false,
              macros: macros,
              fleqn: false
            });
          }
        }
      }
    }
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        typesetMath(container);
        return container.innerHTML
      } else {
        typesetMath(note);
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      typesetMath(note);
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../index.html" class="pagination-link  aria-label=" preface"="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Preface</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../examples/simple-censored-outcome/index.html" class="pagination-link" aria-label="<span class='chapter-number'>2</span>&nbsp; <span class='chapter-title'>One censored outcome</span>">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">One censored outcome</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>