<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Bayesian censoring - 3&nbsp; Example Model 2: One censored outcome</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Ex3-Censored-Outcome-and-Predictor.html" rel="next">
<link href="./Ex1-Simple-Censored-Predictor.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Ex2-Simple-Censored-Outcome.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Example Model 2: One censored outcome</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Bayesian censoring</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">What are censored data?</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ex1-Simple-Censored-Predictor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Example Model 1: One censored predictor</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ex2-Simple-Censored-Outcome.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Example Model 2: One censored outcome</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ex3-Censored-Outcome-and-Predictor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Example Model 3: Censored outcome and censored predictor</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ex4-Infection-Outcome-with-Censored-Predictor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Example Model 4: Logistic regression with censored predictors</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ex5-Interval-Censoring.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Example Model 5: Interval Censoring</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Ex6-HAI-data-outcome.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Example Model 2: One censored outcome</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#lower-limit-of-detection" id="toc-lower-limit-of-detection" class="nav-link active" data-scroll-target="#lower-limit-of-detection"><span class="header-section-number">3.1</span> Lower limit of detection</a>
  <ul class="collapse">
  <li><a href="#imputation-type-method" id="toc-imputation-type-method" class="nav-link" data-scroll-target="#imputation-type-method"><span class="header-section-number">3.1.1</span> Imputation-type method</a></li>
  <li><a href="#integration-type-method" id="toc-integration-type-method" class="nav-link" data-scroll-target="#integration-type-method"><span class="header-section-number">3.1.2</span> Integration-type method</a></li>
  </ul></li>
  <li><a href="#appendix-tobit-model-check" id="toc-appendix-tobit-model-check" class="nav-link" data-scroll-target="#appendix-tobit-model-check">Appendix: tobit model check</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Example Model 2: One censored outcome</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>For the second example model, we’ll work on a case where there is one predictor (the models generalize easily to the multivariable case) and the outcome is censored.</p>
<section id="lower-limit-of-detection" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="lower-limit-of-detection"><span class="header-section-number">3.1</span> Lower limit of detection</h2>
<p>For the first example, we’ll work with an outcome that has a lower limit of detection. First we need to simulate the data, which means we need to write out a generative model for the data. We’ll randomly sample <code>x</code> for the purposes of generating data, but for the purposes of our model we’ll assume <code>x_i</code> is a completely observed covariate and thus is known and does not need a random component in the model.</p>
<p><span class="math display">\[
\begin{align*}
y_i &amp;= \begin{cases}
\mathrm{DL}, &amp; y^*_i \leq \mathrm{DL} \\
y^*_i, &amp; y^*_i &gt; \mathrm{DL}
\end{cases} \\
y^*_i &amp;\sim \mathrm{Normal}\left(\mu_i, \sigma^2\right) \\
\mu_i &amp;= \alpha + \beta \cdot x_i \\
i &amp;= 1, 2, \ldots, n
\end{align*}
\]</span> Here, DL is the <u>D</u>etection <u>L</u>imit, aka the lower limit of detection for the variable. Of course in our generative model, we have set <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\beta\)</span>, and <span class="math inline">\(\sigma^2\)</span> to be fixed population parameters, but for Bayesian inference we would need to assign suitable priors. Let’s set the values and simulate our data. The parameters I set for this example are as follows.</p>
<table class="table">
<thead>
<tr class="header">
<th>Parameter</th>
<th>Value</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(n\)</span></td>
<td>271</td>
<td>Sample size</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\alpha\)</span></td>
<td>72</td>
<td>Regression intercept</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\beta\)</span></td>
<td>3</td>
<td>Regression slope</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\sigma\)</span></td>
<td>5</td>
<td>Standard deviation of outcome</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\mathrm{DL}\)</span></td>
<td>80</td>
<td>Lower limit of detection</td>
</tr>
</tbody>
</table>
<p>The <span class="math inline">\(x\)</span>-values were drawn from a uniform distribution on <span class="math inline">\((0, 10)\)</span>. Since we know the true population parameters for our simulation, we can plot the data to see the effect of the censoring process on our observed <span class="math inline">\(y\)</span> values.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Ex2-Simple-Censored-Outcome_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In this plot, the black data points show our observed data. For those observations where the <span class="math inline">\(y\)</span> value was below the limit of detection and thus censored, the gray points show the true latent values, which we could have observed with a perfect measurement process. The gray line segments connect each latent measurement to its corresponding observed measurement.</p>
<p>Approximatly <span class="math inline">\(22.88\%\)</span> of data points were below the limit of detection and were therefore censored. Of course in real life, we would only observe the black points (observed values), and the gray points would be unobservable to us. But for the purposes of understanding how to analyze censored data, visualizing how different the observed and latent datasets are is quite valuable and informative. Since the datasets look so different, we should not be surprised that our regression estimates would be incorrect if we treated all of the censored values as the same constant value, or ignored them entirely!</p>
<p>So, if our standard linear regression model that we know and love (even the Bayesian version) would give us incorrect estimates using any of these naive methods, how then are we to proceed? According to the Stan manual <span class="citation" data-cites="StanManual">(<a href="references.html#ref-StanManual" role="doc-biblioref">Stan Development Team 2023, chap. 4</a>)</span>, there are two main ways of handling the censoring in the outcome in our model. The first of these methods relies on imputation and the second on integration of the likelihood function and manual updating of the target likelihood in Stan. The imputation method is conceptually easier and less mathematically daunting, so we begin our treatment there.</p>
<section id="imputation-type-method" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="imputation-type-method"><span class="header-section-number">3.1.1</span> Imputation-type method</h3>
<p>The first method for dealing with censored data treats the censored values as missing values where the latent value is constrained to fall within a specific range. For a normally distributed outcome, all values below the lower limit of detection are constrained to fall within <span class="math inline">\((-\infty, \mathrm{DL})\)</span>.</p>
<p>READ THAT PART OF RETHINKING AND EXPLAIN HOW MISSING DATA WORKS HERE!!!</p>
<p>To implement such a model in Stan, we need to pass in the number of observed and the number of censored values and the observed y-values in Stan. We then declare the censored <span class="math inline">\(y\)</span>-values as a parameter in the Stan code, meaning they will be sampled from their constrained distribution during the fitting process, whereas the observed <span class="math inline">\(y\)</span> values will be used to update the parameter estimates.</p>
<p>First, let’s look at the Stan code for this model.</p>
<p>SHOW THE STAN CODE HERE.</p>
<p>Since the data need to be in kind of a clunky format to use this method, we first need to do some wrangle and get the data in the correct format for Stan.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>dat_2a <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    sim_data, {</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>        dat_cens <span class="ot">&lt;-</span> <span class="fu">subset</span>(sim_data, cens)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        dat_obs <span class="ot">&lt;-</span> <span class="fu">subset</span>(sim_data, <span class="sc">!</span>cens)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        dat_2a<span class="sc">$</span>N_cens <span class="ot">&lt;&lt;-</span> <span class="fu">nrow</span>(dat_cens)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>        dat_2a<span class="sc">$</span>N_obs <span class="ot">&lt;&lt;-</span> <span class="fu">nrow</span>(dat_obs)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        dat_2a<span class="sc">$</span>y_obs <span class="ot">&lt;&lt;-</span> dat_obs<span class="sc">$</span>y</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>        dat_2a<span class="sc">$</span>x_obs <span class="ot">&lt;&lt;-</span> dat_obs<span class="sc">$</span>x</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>        dat_2a<span class="sc">$</span>y_cens <span class="ot">&lt;&lt;-</span> dat_cens<span class="sc">$</span>y</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>        dat_2a<span class="sc">$</span>x_cens <span class="ot">&lt;&lt;-</span> dat_cens<span class="sc">$</span>x</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        dat_2a<span class="sc">$</span>DL <span class="ot">&lt;&lt;-</span> <span class="fu">as.integer</span>(sim_parms<span class="sc">$</span>DL)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(dat_2a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 7
 $ N_cens: int 62
 $ N_obs : int 209
 $ y_obs : num [1:209] 92.6 104.2 86.2 88.7 94.9 ...
 $ x_obs : num [1:209] 8.98 9.31 3.42 8.5 8.14 ...
 $ y_cens: num [1:62] 80 80 80 80 80 80 80 80 80 80 ...
 $ x_cens: num [1:62] 0.227 0.555 1.168 2.853 2.434 ...
 $ DL    : int 80</code></pre>
</div>
</div>
<p>Now we can compile the Stan program (via <code>cmdstanr</code> as usual).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>mod_2a <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">cmdstan_model</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"Ex2a.stan"</span>), <span class="at">compile =</span> <span class="cn">FALSE</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>mod_2a<span class="sc">$</span><span class="fu">compile</span>(<span class="at">pedantic =</span> <span class="cn">TRUE</span>, <span class="at">force_recompile =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in 'C:/Users/Zane/AppData/Local/Temp/Rtmp02Gefc/model-f3818262ea.stan', line 56, column 21: Argument
    0.01 suggests there may be parameters that are not unit scale; consider
    rescaling with a multiplier (see manual section 22.12).
Warning in 'C:/Users/Zane/AppData/Local/Temp/Rtmp02Gefc/model-f3818262ea.stan', line 55, column 18: Argument
    100 suggests there may be parameters that are not unit scale; consider
    rescaling with a multiplier (see manual section 22.12).
Warning in 'C:/Users/Zane/AppData/Local/Temp/Rtmp02Gefc/model-f3818262ea.stan', line 54, column 19: Argument
    100 suggests there may be parameters that are not unit scale; consider
    rescaling with a multiplier (see manual section 22.12).
Warning: The parameter y_cens has no priors. This means either no prior is
    provided, or the prior(s) depend on data variables. In the later case,
    this may be a false positive.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>In file included from stan/lib/stan_math/stan/math/prim/prob/von_mises_lccdf.hpp:5,
                 from stan/lib/stan_math/stan/math/prim/prob/von_mises_ccdf_log.hpp:4,
                 from stan/lib/stan_math/stan/math/prim/prob.hpp:356,
                 from stan/lib/stan_math/stan/math/prim.hpp:16,
                 from stan/lib/stan_math/stan/math/rev.hpp:14,
                 from stan/lib/stan_math/stan/math.hpp:19,
                 from stan/src/stan/model/model_header.hpp:4,
                 from C:/Users/Zane/AppData/Local/Temp/Rtmp02Gefc/model-f3818262ea.hpp:2:
stan/lib/stan_math/stan/math/prim/prob/von_mises_cdf.hpp: In function 'stan::return_type_t&lt;T_x, T_sigma, T_l&gt; stan::math::von_mises_cdf(const T_x&amp;, const T_mu&amp;, const T_k&amp;)':
stan/lib/stan_math/stan/math/prim/prob/von_mises_cdf.hpp:194: note: '-Wmisleading-indentation' is disabled from this point onwards, since column-tracking was disabled due to the size of the code/headers
  194 |       if (cdf_n &lt; 0.0)
      | </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>stan/lib/stan_math/stan/math/prim/prob/von_mises_cdf.hpp:194: note: adding '-flarge-source-files' will allow for more column-tracking support, at the expense of compilation time and memory</code></pre>
</div>
</div>
<p>And since the program compiles correctly, we can use Stan’s sampling algorithm to generate samples from the posterior distribution. We’ll run 4 chains in parallel with 500 warmup iterations and 5000 sampling iterations per chains, with all of the other control parameters (e.g.&nbsp;maximum treedepth and adaptive delta) left at the <code>cmdstan</code> defaults. This many samples is overkill for this problem, but it is also quite fast and thus we can do many samples just to be safe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>fit_2a <span class="ot">&lt;-</span> mod_2a<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    dat_2a, <span class="at">seed =</span> <span class="dv">100</span>, <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter_warmup =</span> <span class="dv">500</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter_sampling =</span> <span class="dv">5000</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 parallel chains...

Chain 1 Iteration:    1 / 5500 [  0%]  (Warmup) 
Chain 2 Iteration:    1 / 5500 [  0%]  (Warmup) 
Chain 3 Iteration:    1 / 5500 [  0%]  (Warmup) 
Chain 4 Iteration:    1 / 5500 [  0%]  (Warmup) 
Chain 1 Iteration:  100 / 5500 [  1%]  (Warmup) 
Chain 1 Iteration:  200 / 5500 [  3%]  (Warmup) 
Chain 1 Iteration:  300 / 5500 [  5%]  (Warmup) 
Chain 1 Iteration:  400 / 5500 [  7%]  (Warmup) 
Chain 1 Iteration:  500 / 5500 [  9%]  (Warmup) 
Chain 1 Iteration:  501 / 5500 [  9%]  (Sampling) 
Chain 2 Iteration:  100 / 5500 [  1%]  (Warmup) 
Chain 2 Iteration:  200 / 5500 [  3%]  (Warmup) 
Chain 2 Iteration:  300 / 5500 [  5%]  (Warmup) 
Chain 3 Iteration:  100 / 5500 [  1%]  (Warmup) 
Chain 3 Iteration:  200 / 5500 [  3%]  (Warmup) 
Chain 3 Iteration:  300 / 5500 [  5%]  (Warmup) 
Chain 4 Iteration:  100 / 5500 [  1%]  (Warmup) 
Chain 4 Iteration:  200 / 5500 [  3%]  (Warmup) 
Chain 4 Iteration:  300 / 5500 [  5%]  (Warmup) 
Chain 4 Iteration:  400 / 5500 [  7%]  (Warmup) 
Chain 1 Iteration:  600 / 5500 [ 10%]  (Sampling) 
Chain 1 Iteration:  700 / 5500 [ 12%]  (Sampling) 
Chain 2 Iteration:  400 / 5500 [  7%]  (Warmup) 
Chain 2 Iteration:  500 / 5500 [  9%]  (Warmup) 
Chain 2 Iteration:  501 / 5500 [  9%]  (Sampling) 
Chain 3 Iteration:  400 / 5500 [  7%]  (Warmup) 
Chain 3 Iteration:  500 / 5500 [  9%]  (Warmup) 
Chain 3 Iteration:  501 / 5500 [  9%]  (Sampling) 
Chain 3 Iteration:  600 / 5500 [ 10%]  (Sampling) 
Chain 4 Iteration:  500 / 5500 [  9%]  (Warmup) 
Chain 4 Iteration:  501 / 5500 [  9%]  (Sampling) 
Chain 4 Iteration:  600 / 5500 [ 10%]  (Sampling) 
Chain 4 Iteration:  700 / 5500 [ 12%]  (Sampling) 
Chain 1 Iteration:  800 / 5500 [ 14%]  (Sampling) 
Chain 1 Iteration:  900 / 5500 [ 16%]  (Sampling) 
Chain 2 Iteration:  600 / 5500 [ 10%]  (Sampling) 
Chain 2 Iteration:  700 / 5500 [ 12%]  (Sampling) 
Chain 3 Iteration:  700 / 5500 [ 12%]  (Sampling) 
Chain 3 Iteration:  800 / 5500 [ 14%]  (Sampling) 
Chain 4 Iteration:  800 / 5500 [ 14%]  (Sampling) 
Chain 4 Iteration:  900 / 5500 [ 16%]  (Sampling) 
Chain 1 Iteration: 1000 / 5500 [ 18%]  (Sampling) 
Chain 1 Iteration: 1100 / 5500 [ 20%]  (Sampling) 
Chain 2 Iteration:  800 / 5500 [ 14%]  (Sampling) 
Chain 2 Iteration:  900 / 5500 [ 16%]  (Sampling) 
Chain 3 Iteration:  900 / 5500 [ 16%]  (Sampling) 
Chain 3 Iteration: 1000 / 5500 [ 18%]  (Sampling) 
Chain 4 Iteration: 1000 / 5500 [ 18%]  (Sampling) 
Chain 4 Iteration: 1100 / 5500 [ 20%]  (Sampling) 
Chain 4 Iteration: 1200 / 5500 [ 21%]  (Sampling) 
Chain 1 Iteration: 1200 / 5500 [ 21%]  (Sampling) 
Chain 1 Iteration: 1300 / 5500 [ 23%]  (Sampling) 
Chain 2 Iteration: 1000 / 5500 [ 18%]  (Sampling) 
Chain 2 Iteration: 1100 / 5500 [ 20%]  (Sampling) 
Chain 3 Iteration: 1100 / 5500 [ 20%]  (Sampling) 
Chain 3 Iteration: 1200 / 5500 [ 21%]  (Sampling) 
Chain 4 Iteration: 1300 / 5500 [ 23%]  (Sampling) 
Chain 4 Iteration: 1400 / 5500 [ 25%]  (Sampling) 
Chain 4 Iteration: 1500 / 5500 [ 27%]  (Sampling) 
Chain 1 Iteration: 1400 / 5500 [ 25%]  (Sampling) 
Chain 1 Iteration: 1500 / 5500 [ 27%]  (Sampling) 
Chain 2 Iteration: 1200 / 5500 [ 21%]  (Sampling) 
Chain 2 Iteration: 1300 / 5500 [ 23%]  (Sampling) 
Chain 3 Iteration: 1300 / 5500 [ 23%]  (Sampling) 
Chain 3 Iteration: 1400 / 5500 [ 25%]  (Sampling) 
Chain 4 Iteration: 1600 / 5500 [ 29%]  (Sampling) 
Chain 4 Iteration: 1700 / 5500 [ 30%]  (Sampling) 
Chain 4 Iteration: 1800 / 5500 [ 32%]  (Sampling) 
Chain 1 Iteration: 1600 / 5500 [ 29%]  (Sampling) 
Chain 1 Iteration: 1700 / 5500 [ 30%]  (Sampling) 
Chain 2 Iteration: 1400 / 5500 [ 25%]  (Sampling) 
Chain 3 Iteration: 1500 / 5500 [ 27%]  (Sampling) 
Chain 3 Iteration: 1600 / 5500 [ 29%]  (Sampling) 
Chain 3 Iteration: 1700 / 5500 [ 30%]  (Sampling) 
Chain 4 Iteration: 1900 / 5500 [ 34%]  (Sampling) 
Chain 4 Iteration: 2000 / 5500 [ 36%]  (Sampling) 
Chain 4 Iteration: 2100 / 5500 [ 38%]  (Sampling) 
Chain 1 Iteration: 1800 / 5500 [ 32%]  (Sampling) 
Chain 1 Iteration: 1900 / 5500 [ 34%]  (Sampling) 
Chain 1 Iteration: 2000 / 5500 [ 36%]  (Sampling) 
Chain 2 Iteration: 1500 / 5500 [ 27%]  (Sampling) 
Chain 2 Iteration: 1600 / 5500 [ 29%]  (Sampling) 
Chain 3 Iteration: 1800 / 5500 [ 32%]  (Sampling) 
Chain 3 Iteration: 1900 / 5500 [ 34%]  (Sampling) 
Chain 4 Iteration: 2200 / 5500 [ 40%]  (Sampling) 
Chain 4 Iteration: 2300 / 5500 [ 41%]  (Sampling) 
Chain 1 Iteration: 2100 / 5500 [ 38%]  (Sampling) 
Chain 2 Iteration: 1700 / 5500 [ 30%]  (Sampling) 
Chain 2 Iteration: 1800 / 5500 [ 32%]  (Sampling) 
Chain 3 Iteration: 2000 / 5500 [ 36%]  (Sampling) 
Chain 3 Iteration: 2100 / 5500 [ 38%]  (Sampling) 
Chain 4 Iteration: 2400 / 5500 [ 43%]  (Sampling) 
Chain 4 Iteration: 2500 / 5500 [ 45%]  (Sampling) 
Chain 4 Iteration: 2600 / 5500 [ 47%]  (Sampling) 
Chain 1 Iteration: 2200 / 5500 [ 40%]  (Sampling) 
Chain 1 Iteration: 2300 / 5500 [ 41%]  (Sampling) 
Chain 2 Iteration: 1900 / 5500 [ 34%]  (Sampling) 
Chain 3 Iteration: 2200 / 5500 [ 40%]  (Sampling) 
Chain 3 Iteration: 2300 / 5500 [ 41%]  (Sampling) 
Chain 4 Iteration: 2700 / 5500 [ 49%]  (Sampling) 
Chain 4 Iteration: 2800 / 5500 [ 50%]  (Sampling) 
Chain 1 Iteration: 2400 / 5500 [ 43%]  (Sampling) 
Chain 1 Iteration: 2500 / 5500 [ 45%]  (Sampling) 
Chain 2 Iteration: 2000 / 5500 [ 36%]  (Sampling) 
Chain 2 Iteration: 2100 / 5500 [ 38%]  (Sampling) 
Chain 3 Iteration: 2400 / 5500 [ 43%]  (Sampling) 
Chain 3 Iteration: 2500 / 5500 [ 45%]  (Sampling) 
Chain 4 Iteration: 2900 / 5500 [ 52%]  (Sampling) 
Chain 4 Iteration: 3000 / 5500 [ 54%]  (Sampling) 
Chain 4 Iteration: 3100 / 5500 [ 56%]  (Sampling) 
Chain 1 Iteration: 2600 / 5500 [ 47%]  (Sampling) 
Chain 1 Iteration: 2700 / 5500 [ 49%]  (Sampling) 
Chain 2 Iteration: 2200 / 5500 [ 40%]  (Sampling) 
Chain 2 Iteration: 2300 / 5500 [ 41%]  (Sampling) 
Chain 3 Iteration: 2600 / 5500 [ 47%]  (Sampling) 
Chain 3 Iteration: 2700 / 5500 [ 49%]  (Sampling) 
Chain 4 Iteration: 3200 / 5500 [ 58%]  (Sampling) 
Chain 4 Iteration: 3300 / 5500 [ 60%]  (Sampling) 
Chain 4 Iteration: 3400 / 5500 [ 61%]  (Sampling) 
Chain 1 Iteration: 2800 / 5500 [ 50%]  (Sampling) 
Chain 1 Iteration: 2900 / 5500 [ 52%]  (Sampling) 
Chain 1 Iteration: 3000 / 5500 [ 54%]  (Sampling) 
Chain 2 Iteration: 2400 / 5500 [ 43%]  (Sampling) 
Chain 2 Iteration: 2500 / 5500 [ 45%]  (Sampling) 
Chain 3 Iteration: 2800 / 5500 [ 50%]  (Sampling) 
Chain 3 Iteration: 2900 / 5500 [ 52%]  (Sampling) 
Chain 4 Iteration: 3500 / 5500 [ 63%]  (Sampling) 
Chain 4 Iteration: 3600 / 5500 [ 65%]  (Sampling) 
Chain 4 Iteration: 3700 / 5500 [ 67%]  (Sampling) 
Chain 1 Iteration: 3100 / 5500 [ 56%]  (Sampling) 
Chain 1 Iteration: 3200 / 5500 [ 58%]  (Sampling) 
Chain 2 Iteration: 2600 / 5500 [ 47%]  (Sampling) 
Chain 3 Iteration: 3000 / 5500 [ 54%]  (Sampling) 
Chain 3 Iteration: 3100 / 5500 [ 56%]  (Sampling) 
Chain 4 Iteration: 3800 / 5500 [ 69%]  (Sampling) 
Chain 4 Iteration: 3900 / 5500 [ 70%]  (Sampling) 
Chain 1 Iteration: 3300 / 5500 [ 60%]  (Sampling) 
Chain 1 Iteration: 3400 / 5500 [ 61%]  (Sampling) 
Chain 2 Iteration: 2700 / 5500 [ 49%]  (Sampling) 
Chain 2 Iteration: 2800 / 5500 [ 50%]  (Sampling) 
Chain 3 Iteration: 3200 / 5500 [ 58%]  (Sampling) 
Chain 3 Iteration: 3300 / 5500 [ 60%]  (Sampling) 
Chain 4 Iteration: 4000 / 5500 [ 72%]  (Sampling) 
Chain 4 Iteration: 4100 / 5500 [ 74%]  (Sampling) 
Chain 4 Iteration: 4200 / 5500 [ 76%]  (Sampling) 
Chain 1 Iteration: 3500 / 5500 [ 63%]  (Sampling) 
Chain 1 Iteration: 3600 / 5500 [ 65%]  (Sampling) 
Chain 2 Iteration: 2900 / 5500 [ 52%]  (Sampling) 
Chain 2 Iteration: 3000 / 5500 [ 54%]  (Sampling) 
Chain 3 Iteration: 3400 / 5500 [ 61%]  (Sampling) 
Chain 3 Iteration: 3500 / 5500 [ 63%]  (Sampling) 
Chain 3 Iteration: 3600 / 5500 [ 65%]  (Sampling) 
Chain 4 Iteration: 4300 / 5500 [ 78%]  (Sampling) 
Chain 4 Iteration: 4400 / 5500 [ 80%]  (Sampling) 
Chain 4 Iteration: 4500 / 5500 [ 81%]  (Sampling) 
Chain 1 Iteration: 3700 / 5500 [ 67%]  (Sampling) 
Chain 1 Iteration: 3800 / 5500 [ 69%]  (Sampling) 
Chain 2 Iteration: 3100 / 5500 [ 56%]  (Sampling) 
Chain 2 Iteration: 3200 / 5500 [ 58%]  (Sampling) 
Chain 3 Iteration: 3700 / 5500 [ 67%]  (Sampling) 
Chain 3 Iteration: 3800 / 5500 [ 69%]  (Sampling) 
Chain 4 Iteration: 4600 / 5500 [ 83%]  (Sampling) 
Chain 4 Iteration: 4700 / 5500 [ 85%]  (Sampling) 
Chain 4 Iteration: 4800 / 5500 [ 87%]  (Sampling) 
Chain 1 Iteration: 3900 / 5500 [ 70%]  (Sampling) 
Chain 1 Iteration: 4000 / 5500 [ 72%]  (Sampling) 
Chain 2 Iteration: 3300 / 5500 [ 60%]  (Sampling) 
Chain 3 Iteration: 3900 / 5500 [ 70%]  (Sampling) 
Chain 3 Iteration: 4000 / 5500 [ 72%]  (Sampling) 
Chain 4 Iteration: 4900 / 5500 [ 89%]  (Sampling) 
Chain 4 Iteration: 5000 / 5500 [ 90%]  (Sampling) 
Chain 4 Iteration: 5100 / 5500 [ 92%]  (Sampling) 
Chain 1 Iteration: 4100 / 5500 [ 74%]  (Sampling) 
Chain 1 Iteration: 4200 / 5500 [ 76%]  (Sampling) 
Chain 2 Iteration: 3400 / 5500 [ 61%]  (Sampling) 
Chain 2 Iteration: 3500 / 5500 [ 63%]  (Sampling) 
Chain 3 Iteration: 4100 / 5500 [ 74%]  (Sampling) 
Chain 3 Iteration: 4200 / 5500 [ 76%]  (Sampling) 
Chain 4 Iteration: 5200 / 5500 [ 94%]  (Sampling) 
Chain 4 Iteration: 5300 / 5500 [ 96%]  (Sampling) 
Chain 1 Iteration: 4300 / 5500 [ 78%]  (Sampling) 
Chain 1 Iteration: 4400 / 5500 [ 80%]  (Sampling) 
Chain 2 Iteration: 3600 / 5500 [ 65%]  (Sampling) 
Chain 2 Iteration: 3700 / 5500 [ 67%]  (Sampling) 
Chain 3 Iteration: 4300 / 5500 [ 78%]  (Sampling) 
Chain 3 Iteration: 4400 / 5500 [ 80%]  (Sampling) 
Chain 3 Iteration: 4500 / 5500 [ 81%]  (Sampling) 
Chain 4 Iteration: 5400 / 5500 [ 98%]  (Sampling) 
Chain 4 Iteration: 5500 / 5500 [100%]  (Sampling) 
Chain 4 finished in 2.4 seconds.
Chain 1 Iteration: 4500 / 5500 [ 81%]  (Sampling) 
Chain 1 Iteration: 4600 / 5500 [ 83%]  (Sampling) 
Chain 2 Iteration: 3800 / 5500 [ 69%]  (Sampling) 
Chain 2 Iteration: 3900 / 5500 [ 70%]  (Sampling) 
Chain 3 Iteration: 4600 / 5500 [ 83%]  (Sampling) 
Chain 3 Iteration: 4700 / 5500 [ 85%]  (Sampling) 
Chain 1 Iteration: 4700 / 5500 [ 85%]  (Sampling) 
Chain 1 Iteration: 4800 / 5500 [ 87%]  (Sampling) 
Chain 2 Iteration: 4000 / 5500 [ 72%]  (Sampling) 
Chain 2 Iteration: 4100 / 5500 [ 74%]  (Sampling) 
Chain 3 Iteration: 4800 / 5500 [ 87%]  (Sampling) 
Chain 3 Iteration: 4900 / 5500 [ 89%]  (Sampling) 
Chain 1 Iteration: 4900 / 5500 [ 89%]  (Sampling) 
Chain 1 Iteration: 5000 / 5500 [ 90%]  (Sampling) 
Chain 1 Iteration: 5100 / 5500 [ 92%]  (Sampling) 
Chain 2 Iteration: 4200 / 5500 [ 76%]  (Sampling) 
Chain 3 Iteration: 5000 / 5500 [ 90%]  (Sampling) 
Chain 3 Iteration: 5100 / 5500 [ 92%]  (Sampling) 
Chain 1 Iteration: 5200 / 5500 [ 94%]  (Sampling) 
Chain 1 Iteration: 5300 / 5500 [ 96%]  (Sampling) 
Chain 2 Iteration: 4300 / 5500 [ 78%]  (Sampling) 
Chain 2 Iteration: 4400 / 5500 [ 80%]  (Sampling) 
Chain 3 Iteration: 5200 / 5500 [ 94%]  (Sampling) 
Chain 3 Iteration: 5300 / 5500 [ 96%]  (Sampling) 
Chain 1 Iteration: 5400 / 5500 [ 98%]  (Sampling) 
Chain 1 Iteration: 5500 / 5500 [100%]  (Sampling) 
Chain 2 Iteration: 4500 / 5500 [ 81%]  (Sampling) 
Chain 2 Iteration: 4600 / 5500 [ 83%]  (Sampling) 
Chain 3 Iteration: 5400 / 5500 [ 98%]  (Sampling) 
Chain 3 Iteration: 5500 / 5500 [100%]  (Sampling) 
Chain 1 finished in 3.1 seconds.
Chain 3 finished in 3.0 seconds.
Chain 2 Iteration: 4700 / 5500 [ 85%]  (Sampling) 
Chain 2 Iteration: 4800 / 5500 [ 87%]  (Sampling) 
Chain 2 Iteration: 4900 / 5500 [ 89%]  (Sampling) 
Chain 2 Iteration: 5000 / 5500 [ 90%]  (Sampling) 
Chain 2 Iteration: 5100 / 5500 [ 92%]  (Sampling) 
Chain 2 Iteration: 5200 / 5500 [ 94%]  (Sampling) 
Chain 2 Iteration: 5300 / 5500 [ 96%]  (Sampling) 
Chain 2 Iteration: 5400 / 5500 [ 98%]  (Sampling) 
Chain 2 Iteration: 5500 / 5500 [100%]  (Sampling) 
Chain 2 finished in 3.6 seconds.

All 4 chains finished successfully.
Mean chain execution time: 3.0 seconds.
Total execution time: 3.8 seconds.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the posterior samples in a nicer format for later</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>post_2a <span class="ot">&lt;-</span> posterior<span class="sc">::</span><span class="fu">as_draws_df</span>(fit_2a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The first thing we should do after sampling is check for any diagnostic warnings. We have access to all of the individual diagnostics, but fortunately <code>cmdstan</code> has a built-in diagnostic checker to flag any potential problems.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>fit_2a<span class="sc">$</span><span class="fu">cmdstan_diagnose</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Processing csv files: C:/Users/Zane/AppData/Local/Temp/Rtmp02Gefc/Ex2a-202310182050-1-5f1ade.csv, C:/Users/Zane/AppData/Local/Temp/Rtmp02Gefc/Ex2a-202310182050-2-5f1ade.csv, C:/Users/Zane/AppData/Local/Temp/Rtmp02Gefc/Ex2a-202310182050-3-5f1ade.csv, C:/Users/Zane/AppData/Local/Temp/Rtmp02Gefc/Ex2a-202310182050-4-5f1ade.csv

Checking sampler transitions treedepth.
Treedepth satisfactory for all transitions.

Checking sampler transitions for divergences.
No divergent transitions found.

Checking E-BFMI - sampler transitions HMC potential energy.
E-BFMI satisfactory.

Effective sample size satisfactory.

Split R-hat values satisfactory all parameters.

Processing complete, no problems detected.</code></pre>
</div>
</div>
<p>Great, no issues with the sampling procedure, that is what we like to see. Let’s manually check the trace plots for our main three parameters of interest. (We could also check the plots for all of the imputed y-values, but these are unlikely to be interesting or useful, any problems should hopefully propagate through to the interesting parameters.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_combo</span>(post_2a, <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">'alpha'</span>, <span class="st">'beta'</span>, <span class="st">'sigma'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ex2-Simple-Censored-Outcome_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Those look like nice healthy trace plots, so with that combined with our diagnostic check, it seems that the chains mixed well and explored the posterior distribution. We can also check if those parameters were correlated.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_pairs</span>(post_2a, <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">'alpha'</span>, <span class="st">'beta'</span>, <span class="st">'sigma'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ex2-Simple-Censored-Outcome_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We see that the slope and intercept estimates were strongly correlated, which makes sense, and the sigma parameter was slightly correlated with both of those but not strongly with either. We can notice here that the histograms for <span class="math inline">\(\beta\)</span> and <span class="math inline">\(\sigma\)</span> are not quite centered at the true values, but they do have some probability mass at those true values. Let’s look at the median estimates and CIs from our samples.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>par_sum <span class="ot">&lt;-</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    fit_2a<span class="sc">$</span><span class="fu">summary</span>(<span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"alpha"</span>, <span class="st">"beta"</span>, <span class="st">"sigma"</span>))</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>par_sum <span class="sc">|&gt;</span> knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">median</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">mad</th>
<th style="text-align: right;">q5</th>
<th style="text-align: right;">q95</th>
<th style="text-align: right;">rhat</th>
<th style="text-align: right;">ess_bulk</th>
<th style="text-align: right;">ess_tail</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">alpha</td>
<td style="text-align: right;">73.175358</td>
<td style="text-align: right;">73.195200</td>
<td style="text-align: right;">0.7612478</td>
<td style="text-align: right;">0.7649475</td>
<td style="text-align: right;">71.910180</td>
<td style="text-align: right;">74.395245</td>
<td style="text-align: right;">1.000667</td>
<td style="text-align: right;">8533.648</td>
<td style="text-align: right;">10108.17</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta</td>
<td style="text-align: right;">2.809101</td>
<td style="text-align: right;">2.806420</td>
<td style="text-align: right;">0.1216903</td>
<td style="text-align: right;">0.1226851</td>
<td style="text-align: right;">2.614248</td>
<td style="text-align: right;">3.010981</td>
<td style="text-align: right;">1.000255</td>
<td style="text-align: right;">9050.044</td>
<td style="text-align: right;">11862.90</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sigma</td>
<td style="text-align: right;">4.897496</td>
<td style="text-align: right;">4.891605</td>
<td style="text-align: right;">0.2447610</td>
<td style="text-align: right;">0.2444807</td>
<td style="text-align: right;">4.515708</td>
<td style="text-align: right;">5.316280</td>
<td style="text-align: right;">1.000053</td>
<td style="text-align: right;">16448.745</td>
<td style="text-align: right;">13836.85</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We can also plot those along with the true values for reference.</p>
<div class="cell">
<details>
<summary>Show plot code (messy)</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>truth <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"alpha"</span>, <span class="st">"beta"</span>, <span class="st">"sigma"</span>),</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> <span class="fu">c</span>(sim_parms<span class="sc">$</span>alpha, sim_parms<span class="sc">$</span>beta, sim_parms<span class="sc">$</span>sigma)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>hd <span class="ot">&lt;-</span> post_2a <span class="sc">|&gt;</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    tibble<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(alpha, beta, sigma) <span class="sc">|&gt;</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">everything</span>())</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> value) <span class="sc">+</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> <span class="fu">subset</span>(hd, name <span class="sc">==</span> <span class="st">"alpha"</span>),</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">boundary =</span> <span class="dv">0</span>,</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">binwidth =</span> <span class="fl">0.25</span>,</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"black"</span>,</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> <span class="st">"gray"</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> <span class="fu">subset</span>(hd, name <span class="sc">==</span> <span class="st">"beta"</span>),</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">boundary =</span> <span class="dv">0</span>,</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">binwidth =</span> <span class="fl">0.05</span>,</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"black"</span>,</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> <span class="st">"gray"</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> <span class="fu">subset</span>(hd, name <span class="sc">==</span> <span class="st">"sigma"</span>),</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">boundary =</span> <span class="dv">0</span>,</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">binwidth =</span> <span class="fl">0.1</span>,</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"black"</span>,</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> <span class="st">"gray"</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> truth,</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>        <span class="fu">aes</span>(<span class="at">xintercept =</span> value),</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">linewidth =</span> <span class="dv">1</span>,</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"red"</span></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>name, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Ex2-Simple-Censored-Outcome_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>From these histograms, we can see that while there is a decent amount of samples close to the true values of alpha and beta, the posterior distributions are not centered around the true values. At the time of writing, I am not sure if that is a fixable problem or just something we have to deal with from having imperfectly observed data.</p>
<p>We can also do a check of how close the imputed <span class="math inline">\(y\)</span> values were on average to the actual <span class="math inline">\(y\)</span> values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>y_cens_sum <span class="ot">&lt;-</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    fit_2a<span class="sc">$</span><span class="fu">summary</span>(<span class="at">variables =</span> <span class="fu">paste0</span>(<span class="st">'y_cens['</span>, <span class="dv">1</span><span class="sc">:</span>dat_2a<span class="sc">$</span>N_cens, <span class="st">']'</span>))</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>dat_comp <span class="ot">&lt;-</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    sim_data <span class="sc">|&gt;</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">subset</span>(cens) <span class="sc">|&gt;</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(y_star) <span class="sc">|&gt;</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(y_cens_sum) <span class="sc">|&gt;</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>            (mean <span class="sc">&gt;=</span> y_star) <span class="sc">&amp;</span> (q5 <span class="sc">&lt;=</span> y_star) <span class="sc">~</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>            (mean <span class="sc">&lt;=</span> y_star) <span class="sc">&amp;</span> (q95 <span class="sc">&gt;=</span> y_star) <span class="sc">~</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>            <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">FALSE</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(dat_comp) +</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   aes(x = y_star, y = mean, ymin = q5, ymax = q95, color = col) +</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="co">#       geom_abline(</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="co">#           slope = 1, intercept = 0, linetype = 2, linewidth = 1,</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="co">#                               alpha = 0.5</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="co">#           ) +</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_errorbar(alpha = 0.25) +</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point() +</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="co">#   coord_fixed() +</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_color_manual(</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a><span class="co">#       values = c("orange", "turquoise"),</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a><span class="co">#       name = "CI crosses diagonal"</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat_comp) <span class="sc">+</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> (y_star <span class="sc">-</span> mean)) <span class="sc">+</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">boundary =</span> <span class="dv">0</span>, <span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">2</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"True value - mean estimated value"</span></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ex2-Simple-Censored-Outcome_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>TODO make this relative error instead to make it easier to understand.</p>
</section>
<section id="integration-type-method" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="integration-type-method"><span class="header-section-number">3.1.2</span> Integration-type method</h3>
<p>The second method relies on calculating the direct contribution of the censored data measurements to the likelihood by integrating the density over the region where censored data can occur. That is, if the <span class="math inline">\(i\)</span>th observation is below the detection limit, we know that the contribution of that observation to the sample likelihood is <span class="math display">\[
\mathcal{L}(\theta \mid y_i) = P(Y_i \leq \mathrm{DL}) = \int_{-\infty}^{\mathrm{DL}}f(y_i \mid \theta) \ dy = \lim_{a \to -\infty} \left[F(y_i \mid \theta)\right]_{a}^{\mathrm{DL}},
\]</span> which is why we refer to this method as “integrating out” the censored values.</p>
<p>By adapting the Stan code from the manual <span class="citation" data-cites="StanManual">(<a href="references.html#ref-StanManual" role="doc-biblioref">Stan Development Team 2023</a>, cp.&nbsp;4)</span> to include <span class="math inline">\(x\)</span> values in the calculation of the mean, we can implement this method for dealing with our censored <span class="math inline">\(y\)</span> values. First we’ll load and compile the Stan model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>mod_2b <span class="ot">&lt;-</span> cmdstanr<span class="sc">::</span><span class="fu">cmdstan_model</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"Ex2b.stan"</span>), <span class="at">compile =</span> <span class="cn">FALSE</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>mod_2b<span class="sc">$</span><span class="fu">compile</span>(<span class="at">force_recompile =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb18"><pre class="sourceCode stan code-with-copy"><code class="sourceCode stan"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Ex2a: One censored predictor using the imputation method</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co">// has one lower limit of detection only</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co">// See: https://mc-stan.org/docs/stan-users-guide/censored-data.html</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Zane Billings</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co">// 2023-10-17</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co">// The input data consists of:</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co">// - N: </span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co">// - N_cens: an integer, the number of data points where the outcome was below</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co">//   the DL and thus censored.</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co">// - y: real array of observed outcome variable</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="co">// - cens: int array; indicator which is 1 if the corresponding measurement of</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="co">//   y is censored and 0 otherwise.</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="co">// - x: real array of observed predictor variable</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="co">// - DL: int, the detection limit of the assay (right now it has to be</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="co">//   identical for all observations but we want to change that in future)</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> {</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>	<span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; N;</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>	<span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>, <span class="kw">upper</span>=N&gt; N_cens;</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>	<span class="dt">array</span>[N] <span class="dt">real</span> y;</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>	<span class="dt">array</span>[N] <span class="dt">int</span> cens;</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>	<span class="dt">array</span>[N] <span class="dt">real</span> x;</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>	<span class="dt">int</span>&lt;<span class="kw">upper</span>=to_int(min(y))&gt; DL;</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="co">// transformed data are values we can calculate directly from the inputted data.</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a><span class="co">// - N_cens is an integer equal to N_cens + N_obs.</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a><span class="co">// transformed data {</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a><span class="co">// 	int&lt;lower=0 upper=N&gt; N_obs;</span></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a><span class="co">// 	N_obs = N_cens - N;</span></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a><span class="co">// }</span></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a><span class="co">// The parameters accepted by the model. Our model</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a><span class="co">// accepts the real-valued parameters alpha, beta, (the regression coefs) and</span></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a><span class="co">// the positive real-valued parameter sigma (the variance of the outcome</span></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a><span class="co">// distribution).</span></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>	<span class="co">// Regression parameters</span></span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>	<span class="dt">real</span> alpha;</span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>	<span class="dt">real</span> beta;</span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>	<span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; sigma;</span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a><span class="co">// The model to be estimated.</span></span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>	<span class="co">// Priors for parameters</span></span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>	alpha ~ normal(<span class="dv">0</span>, <span class="dv">100</span>);</span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>	beta ~ normal(<span class="dv">0</span>, <span class="dv">100</span>);</span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>	sigma ~ exponential(<span class="fl">0.01</span>);</span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>	</span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a>	<span class="co">// Loop through each observation and calculate the mean. If the current</span></span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>	<span class="co">// y value is observed, treat it like normal. If it is censored, we need to</span></span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a>	<span class="co">// update the likelihood by integrating out the value.</span></span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a>	<span class="dt">array</span>[N] <span class="dt">real</span> mu;</span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a>	<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span>:N) {</span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a>		mu[i] = alpha + beta * x[i];</span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a>		<span class="cf">if</span> (cens[i] == <span class="dv">0</span>) {</span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a>			y[i] ~ normal(mu[i], sigma);</span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a>		} <span class="cf">else</span> <span class="cf">if</span> (cens[i] == <span class="dv">1</span>) {</span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a>			<span class="kw">target +=</span> normal_lcdf(DL | mu[i], sigma);</span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a>		}</span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a>	}</span>
<span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-66"><a href="#cb18-66" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>As you can see from the above program, the data needs to be in a different format for this method. Actually, it’s much easier to set up the data in the way this program specifies, and it’s very similar to the data frame we already have. We just need a list and a few other components.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>dat_2b <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>dat_2b<span class="sc">$</span>N <span class="ot">&lt;-</span> <span class="fu">nrow</span>(sim_data)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>dat_2b<span class="sc">$</span>N_cens <span class="ot">&lt;-</span> <span class="fu">sum</span>(sim_data<span class="sc">$</span>cens)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>dat_2b<span class="sc">$</span>y <span class="ot">&lt;-</span> sim_data<span class="sc">$</span>y</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>dat_2b<span class="sc">$</span>cens <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(sim_data<span class="sc">$</span>cens)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>dat_2b<span class="sc">$</span>x <span class="ot">&lt;-</span> sim_data<span class="sc">$</span>x</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>dat_2b<span class="sc">$</span>DL <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(sim_parms<span class="sc">$</span>DL)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(dat_2b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 6
 $ N     : int 271
 $ N_cens: int 62
 $ y     : num [1:271] 92.6 104.2 86.2 88.7 94.9 ...
 $ cens  : int [1:271] 0 0 0 0 0 0 0 0 0 0 ...
 $ x     : num [1:271] 8.98 9.31 3.42 8.5 8.14 ...
 $ DL    : int 80</code></pre>
</div>
</div>
<p>Now that we have the program ready and the data set up, we can give the data to the program and do some MCMC sampling. We’ll use a similar setup that we did for the previous example, namely 4 parallel chains which each run 500 warmup iterations and 1000 sampling iterations (no need for overkill like we did before).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>fit_2b <span class="ot">&lt;-</span> mod_2b<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    dat_2b, <span class="at">seed =</span> <span class="dv">100</span>, <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter_warmup =</span> <span class="dv">500</span>,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter_sampling =</span> <span class="dv">1000</span>,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">show_messages =</span> <span class="cn">FALSE</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the posterior samples in a nicer format for later</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>post_2b <span class="ot">&lt;-</span> posterior<span class="sc">::</span><span class="fu">as_draws_df</span>(fit_2b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We didn’t get any warnings or errors, which means that the model finished the sampling procedure without any major errors, and we should next check the diagnostics.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>fit_2b<span class="sc">$</span><span class="fu">cmdstan_diagnose</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Processing csv files: C:/Users/Zane/AppData/Local/Temp/Rtmp02Gefc/Ex2b-202310182051-1-69625b.csv, C:/Users/Zane/AppData/Local/Temp/Rtmp02Gefc/Ex2b-202310182051-2-69625b.csv, C:/Users/Zane/AppData/Local/Temp/Rtmp02Gefc/Ex2b-202310182051-3-69625b.csv, C:/Users/Zane/AppData/Local/Temp/Rtmp02Gefc/Ex2b-202310182051-4-69625b.csv

Checking sampler transitions treedepth.
Treedepth satisfactory for all transitions.

Checking sampler transitions for divergences.
No divergent transitions found.

Checking E-BFMI - sampler transitions HMC potential energy.
E-BFMI satisfactory.

Effective sample size satisfactory.

Split R-hat values satisfactory all parameters.

Processing complete, no problems detected.</code></pre>
</div>
</div>
<p>Everything looks good here, but let’s again look at the traceplots.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_combo</span>(post_2b, <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">'alpha'</span>, <span class="st">'beta'</span>, <span class="st">'sigma'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Ex2-Simple-Censored-Outcome_files/figure-html/model 2b traceplot-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We got some nice, healthy looking fuzzy caterpillars, so now we can be confident in our summary results. So now let’s finally look at the parameter estimates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>fit_2b<span class="sc">$</span><span class="fu">summary</span>(<span class="at">variables =</span> <span class="fu">c</span>(<span class="st">'alpha'</span>, <span class="st">'beta'</span>, <span class="st">'sigma'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 10
  variable  mean median    sd   mad    q5   q95  rhat ess_bulk ess_tail
  &lt;chr&gt;    &lt;num&gt;  &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;    &lt;num&gt;    &lt;num&gt;
1 alpha    73.1   73.1  0.767 0.803 71.8  74.3   1.00    1324.    1250.
2 beta      2.82   2.81 0.122 0.126  2.62  3.02  1.00    1285.    1479.
3 sigma     4.90   4.90 0.243 0.244  4.52  5.32  1.00    2114.    2269.</code></pre>
</div>
</div>
<p>These estimates are pretty similar to the estimates from the other method, which is good in a way because it means both methods are similar. The frequentist tobit model estimate is also similar (see the appendix).</p>
<p>Unfortunately, none of the three models to estimate the regression value while taking the censoring into account produce estimates that are exactly the same as the true simulation parameters. However, unlike the much worse naive model estimates, at least our uncertainty intervals correctly contain the true values this time. So we cannot fully erase the effect of the flawed observation process on our data, but we can do a lot better by taking the censored data into consideration.</p>
</section>
</section>
<section id="appendix-tobit-model-check" class="level2 appendix unnumbered">
<h2 class="appendix unnumbered anchored" data-anchor-id="appendix-tobit-model-check">Appendix: tobit model check</h2>
<p>Since we’re dealing with one censored outcome with a known limit of detection, there are actually some well-developed frequentist methods for this problem. Namely, we can use a <strong>tobit model</strong>, which specificies the likelihood model in the same way we did for the bayesian estimation method, and works very similarly to the second method where we integrate out the censored data points. However, instead of specifying priors to get a posterior distribution via Bayes’ theorem, we instead estimate the parameters by finding the parameters which maximize the sample likelihood.</p>
<p>Many models for censored outcomes with a variety of distributions are implemented in the R core package <code>survival</code>, but the formula for specifying a tobit model with a gaussian outcome distribution correctly is very unintuitive. Thankfully, the package <code>AER</code> provides a simple <code>tobit()</code> wrapper which translates a more standard formula into the appropriate form for the <code>survReg()</code> function and fits the model. Fitting our model using <code>AER::tobit()</code> is simple.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>tobit_model <span class="ot">&lt;-</span> AER<span class="sc">::</span><span class="fu">tobit</span>(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    y <span class="sc">~</span> x,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sim_data,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">left =</span> sim_parms<span class="sc">$</span>DL,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">right =</span> <span class="cn">Inf</span>,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">dist =</span> <span class="st">"gaussian"</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(tobit_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
AER::tobit(formula = y ~ x, left = sim_parms$DL, right = Inf, 
    dist = "gaussian", data = sim_data)

Observations:
         Total  Left-censored     Uncensored Right-censored 
           271             62            209              0 

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) 73.21256    0.75531   96.93   &lt;2e-16 ***
x            2.80427    0.12071   23.23   &lt;2e-16 ***
Log(scale)   1.57771    0.04957   31.83   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Scale: 4.844 

Gaussian distribution
Number of Newton-Raphson Iterations: 6 
Log-likelihood: -661.2 on 3 Df
Wald-statistic: 539.7 on 1 Df, p-value: &lt; 2.22e-16 </code></pre>
</div>
</div>
<p>If we want a lot of compatibility with standard R functions however (e.g. <code>broom::tidy()</code> to get the confidence intervals for the parameters), we need to use <code>survreg</code>. Fortunately the documentation for <code>AER::tobit()</code> explains how the formula is transmogrified.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>U <span class="ot">&lt;-</span> sim_parms<span class="sc">$</span>DL</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>survreg_model <span class="ot">&lt;-</span> survival<span class="sc">::</span><span class="fu">survreg</span>(</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    survival<span class="sc">::</span><span class="fu">Surv</span>(y, y <span class="sc">&gt;</span> U, <span class="at">type =</span> <span class="st">'left'</span>) <span class="sc">~</span> x,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sim_data,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">dist =</span> <span class="st">"gaussian"</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(survreg_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
survival::survreg(formula = survival::Surv(y, y &gt; U, type = "left") ~ 
    x, data = sim_data, dist = "gaussian")
              Value Std. Error    z      p
(Intercept) 73.2126     0.7553 96.9 &lt;2e-16
x            2.8043     0.1207 23.2 &lt;2e-16
Log(scale)   1.5777     0.0496 31.8 &lt;2e-16

Scale= 4.84 

Gaussian distribution
Loglik(model)= -661.2   Loglik(intercept only)= -831
    Chisq= 339.55 on 1 degrees of freedom, p= 8e-76 
Number of Newton-Raphson Iterations: 6 
n= 271 </code></pre>
</div>
</div>
<p>We can see that the two models are exactly the same. But since we’ve used a model from <code>survival</code>, we get the benefit of widespread compatibility with other <code>R</code>-ecosystem functionality. For example, we can easily get confidence intervals for all three estimated parameters with <code>broom</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>broom<span class="sc">::</span><span class="fu">tidy</span>(survreg_model, <span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 7
  term        estimate std.error statistic   p.value conf.low conf.high
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)    73.2     0.755       96.9 0            71.7      74.7 
2 x               2.80    0.121       23.2 2.15e-119     2.57      3.04
3 Log(scale)      1.58    0.0496      31.8 2.77e-222    NA        NA   </code></pre>
</div>
</div>
<p>Or at least I thought we could. Apparently there is not a built-in method to give the CI for the scale parameter, and we have to do it ourselves.</p>
<div class="cell">
<details>
<summary>Code for 95% CI for scale</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Scale estimate: "</span>,</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(<span class="fu">exp</span>(<span class="fl">1.58</span>), <span class="dv">2</span>),</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">", 95% CI: "</span>,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(<span class="fu">exp</span>(<span class="fl">1.58</span> <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> <span class="fl">0.0496</span>), <span class="dv">2</span>),</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">" - "</span>,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(<span class="fu">exp</span>(<span class="fl">1.58</span> <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> <span class="fl">0.0496</span>), <span class="dv">2</span>),</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"."</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Scale estimate: 4.85, 95% CI: 4.41 - 5.35."</code></pre>
</div>
</div>
<p>Anyways, we can compare these to the Bayesian estimates above and see that they are quite similar.</p>
<!-- END OF FILE -->


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-StanManual" class="csl-entry" role="listitem">
Stan Development Team. 2023. <em>Stan <span>Modeling Language Users</span>’ <span>Guide</span> and <span>Reference Manual</span></em>. 2.33 ed.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Ex1-Simple-Censored-Predictor.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Example Model 1: One censored predictor</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Ex3-Censored-Outcome-and-Predictor.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Example Model 3: Censored outcome and censored predictor</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>