{
  "hash": "1b67750ddda5beb78963ff4ffa9668b0",
  "result": {
    "markdown": "# Example Model 6: the HAI manifesto\n\n\n\n\n\nMost of my research about the influenza vaccine is focused on the analysis of\nHemagglutination Inhibition (HAI) assay data. These data are proxies for\nneutralizing influenza antibodies, and have the advantage of being easy to\nperform and being able to capture cross-reactivity across different strains of\ninfluenza. However, the assay has a unique data generating process. I've\ndiscussed this before in a few posts on my blog (\n[first](https://wzbillings.com/posts/2023-07-25_simulating-titer-data/),\n[second](https://wzbillings.com/posts/2023-08-10_titer-w-distance/)), but I\nnever got to the part where we actually fit the models to make sure our\ncensoring approach works.\n\nHAI makes a potentially interesting example because of three features of the\ndata:\n\n1. The outcome is left censored with a lower limit of detection;\n1. The outcome is interval censored for values above the LLOD; and\n1. There are two appropriate models, which we can compare and contrast.\n\nFor all of these models, we'll work under one general example study. Suppose\nwe recruit $n$ patients for a study and give them a flu vaccine. For each of\nthose patients, we collect their pre-vaccination titer and post-vaccination\n(say at 28 days) to 11 different influenza strains. These strains include the\nsame strain that is in the vaccine (which has distance $0$), and ten other\nstrains, which each have distances $d = \\{0.1, 0.2, 0.3, \\ldots, 1.0\\}$. The\noutcome variable, post-vaccination titers, will be left-censored and also\ninterval-censored. We assume that the mean of the outcome is a linear\nfunction of the distance. Unfortunately the two models we need to consider\nare hard to describe in the same language, so we'll get down to brass tacks\nwith the data generating process (DGP) in the respective sections.\n\nFor dealing with interval censored data, we will pass the\ndata to Stan using the `interval2` format from the `survival` package. In this\nformat, we pass two columns, say `y_l` and `y_u`. If a data point is not\ncensored, then `y_l == y_u`. If a data point is left-censored, then `y_l = -Inf`\nand `y_u` is set to the lower limit of detection. Similarly, if a data point\nis right-censored, `y_l` is set to the upper limit of detection and `y_u = Inf`.\nFinally, if a data point is interval-censored, `y_l` and `y_u` are set to the\nlower and upper bounds of the interval containing the datum, respectively.\n\n## Log-normal model\n\nBoth of these models will share a lot of similarities, but for some reason\nI find the lognormal model easier to think about, so we'll do most of the\nexplaining under the context of this model. We start with the assumption that\nour *underyling, latent titer* value (the \"true titer\") is some real number\nwhich follows a log-normal distribution. We assume that the mean of this\ndistribution is a linear function of the antigenic distance, as we mentioned,\nand we assume constant variance. In math terms, we assume that\n$$\ny_i^* \\sim \\text{Log-normal}\\left(\\frac{\\beta_0 + \\beta_1 x_i}{\\log_2 e}, \\frac{\\sigma}{\\log_2 e}\\right).\n$$\nNote that we scale the coefficients by a factor of $\\frac{1}{\\log_2{e}}$\nbecause\n$$\\log{y_i^*} \\sim \\text{Normal}\\left( \\frac{\\beta_0 + \\beta_1 x_i}{\\log_2 e}, \\frac{\\sigma}{\\log_2 e} \\right),$$\nwhich combined with the identity that\n$$\\log{y_i^*} = \\frac{\\log_2 y_i^*}{\\log_2{e}},$$\nimplies\n$$ \\log_2 y_i^* \\sim \\text{Normal}\\left( \\beta_0 + \\beta_1 x_i, \\sigma \\right) .$$\nThis gives us a connection to the natural units of measurement, and makes it\neasier to understand the models and set priors.\n\n\n## Gamma model\n\nADD A CALLOUT BOX HERE\n\n### Gamma distribution parametrization {.unnumbered}\nThere are at least three common reparametrizations of the Gamma parametrization.\nHere, we follow the convention used by\n[Stan](https://mc-stan.org/docs/functions-reference/gamma-distribution.html),\nwhich is different from the parametrization implemented by Richard McElreath\nin the `rethinking` package. Note that in the common $\\alpha, \\beta$\nparametrization that we adopt, one can easily model the mean by implementing\nthe probability model as\n$$\ny_i \\sim \\text{Gamma}\\left(\\alpha_i = \\frac{\\mu_i}{\\beta}, \\beta\\right).\n$$\nSo, if you were curious, that is where the $\\frac{1}{\\beta}$ comes from\nin the following section.\n\n## Midpoint correction instead of interval censoring\n\n## Extensions to consider in the future\n\n* An individual is randomly missing strains due to laboratory errors\n* Repeated measures across study years\n* Repeated measures across study years where some strains are systematically\nmissing based on the year\n* Models which control for pre-vaccination titer.\n\n<!-- END OF FILE -->\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}